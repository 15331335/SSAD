# 架构建模

## 软件架构的概念

### Architecture

软件架构是对于软件系统组织的一系列重要决定。

- 结构化元素的选择
- 组成系统的接口
- 元素间协作关系的行为

### Styles

架构模式是对于**特定领域**常见问题的元素组织与协作的解决方案。

- 信息系统领域：多层架构
- 结构化设计领域：模块化架构
- 消息服务领域：消息过滤、数据黑板、消息路由

### Tips

- 软件结构是业界长期最佳实践的总结
  - **选择**优于创造
  - **理解结构**优于硬搬框架
- 理解系统 **big picture**
  - 语言无关
- 评估产品结构的合理性
  - 评价模块的内聚性（聚焦？ 一句话描述模块的职责）
  - 评价模块间耦合性（有序？ 消息流或依赖是否单向）

###Frameworks

框架是特定**语言**和技术的**架构**应用解决方案。

- 框架是具体语言和技术相关的
- 框架是一种或多种架构的组合的实现
- 框架是集成了代码和多种第三方解决方案的工具
- 使用框架从而可以聚焦**业务逻辑代码**而**不是技术实现**

## 架构的设计

### Background

软件架构是由 IBM 推动的技术概念，对应的职业就是软件架构师。 

- 建立一套规范的软件工程方法描述用户的高层需求
- 让软件系统支持的业务系统可持续发展
- 面对复杂业务系统的复杂性而客户关注结果的矛盾



### Methodology

**需求种类的复杂性**：超市系统案例

| 非功能需求                 | ---                | ---                | 功能需求                                                     |
| -------------------------- | ------------------ | ------------------ | ------------------------------------------------------------ |
| **约束**                   | **运行期质量属性** | **开发期质量属性** | **---**                                                      |
| 项目预算有限               | 高性能             | 易理解性           | 提高收银效率                                                 |
| 用户的平均电脑操作水平偏低 | 易用性             | 模块间松散耦合     | 任意商品项可单独取消                                         |
| 要求能在 Linux 上运行      | ...                | ...                | 通过收银终端的按键组合，可以使收银过程从「逐项录入状态」进入「选择取消状态」 |
| ...                        |                    |                    | …                                                            |



**4+1视图方法**

一个架构视图是对于从某一视角或某一点上看到的系统所做的简化描述，描述中涵盖了系统的某一特定方面，而省略了于此方面无关的实体。

在场景视图（对业务进行分析，提出架构需要满足的需求）下：

- **逻辑视图**：当采用面向对象的设计方法时，逻辑视图即对象模型。（功能需求，通常用包图表示）
- **开发视图**：描述软件在开发环境下的静态组织。（开发期质量属性，通常用包或对象之间的交互顺序图表示）
- **处理视图**：描述系统的并发和同步方面的设计。（运行期质量属性，通常用软件制品之间的交互顺序图表）
- **物理视图**：描述软件如何映射到硬件，反映系统在分布方面的设计。（安装和部署需求，通常用部署图表示）



**实践**

- 利用业务场景视图获取架构需求编写需求文档
- 利用包图描述类与包的组织
- 利用部署图表示产品的实施与部署



**架构需求的获取**

- 利益相关人及其关注点分析

- 编写架构需求 **Supplementary Sepcification**

  架构需求按 `FURPS+` 模型组织，重点是 `URPS+`。软件架构又称为非功能驱动的设计，又称 `FDD` (Feature-driven development)。



**逻辑架构设计**

三层模型（表示层、业务层、持久化层）

1. **层与分区准则**：
   - 表示层：一般按用户角色划分分区，以点餐系统为例：用户点餐子系统、餐厅管理子系统、餐厅厨房管理子系统、运维服务子系统等
   - 业务层: 一般按业务功能服务划分分区，以点餐系统为例：用户管理模块、菜品管理模块、订单管理模块、配餐管理模块、餐厅服务行为管理、餐厅管理等
   - 持久化层：按核心交易实体管理（资源管理），以点餐系统为例：用户、菜品、订单等等的 CRUD
2. 逻辑设计的好处
3. 包的命名规范
4. 实际应用包的组织



**物理视图设计**

- 部署图的元素
- 案例研究



### Document

参考教材



##云时代的软件架构

**云应用程序体系架构的作用**

[Azure 应用程序体系结构指南](https://docs.microsoft.com/zh-cn/azure/architecture/guide/)

通过该文档，你应该了解：

- 架构风格的核心作用是什么？
- 云服务架构关注了哪些问题？
- 云服务架构的读者（客户）是谁？
- 架构设计涉及的内容有哪些？

**云服务的两种典型架构风格**

[微服务体系结构样式](https://docs.microsoft.com/zh-cn/azure/architecture/guide/architecture-styles/microservices)

[CQRS 体系结构样式](https://docs.microsoft.com/zh-cn/azure/architecture/guide/architecture-styles/cqrs)

通过上述文档，你应该了解：

- 微服务架构的使用场景？
- 不同风格不是互斥的，而是相容的。例如：在微服务中使用读写分离是解决高并发，如100万以上用户的基本手段

**CQRS 与 事件溯源**

[命令和查询责任分离 (CQRS) 模式](https://docs.microsoft.com/zh-cn/azure/architecture/patterns/cqrs)

[事件溯源模式](https://docs.microsoft.com/zh-cn/azure/architecture/patterns/event-sourcing)

[什么是 Flux 架构？](https://juejin.im/entry/577f06e62e958a0054af5a2a)

通过上述文档，你应该了解：

- 事件溯源 与 CQRS 是一对常见的组合
- Flux 架构设计者如何思考设计模式改进 MVC 状态管理
- 架构风格与设计模式的区别？

参考阅读：Martin Fowler [CQRS](https://martinfowler.com/bliki/CQRS.html)

